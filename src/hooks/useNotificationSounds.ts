import { useCallback, useRef, useEffect } from 'react';

type NotificationSoundType = 'achievement' | 'signal' | 'session' | 'alert' | 'success';

// Base64 encoded sounds for different notification types
const SOUND_URLS: Record<NotificationSoundType, string> = {
  achievement: 'data:audio/wav;base64,UklGRl9vAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhO28AAP//AQAFAAEA/f8HAAgA+/8EAAUA/f8FAA4ACgAAAP7/BQAKAA8ACgAEAAIABwAHAAcACAANABEAFAAQAAsABwALAA4AEQATABMADwAMAAsADAANAA4ADwAOAA0ACwAKAAkACgAKAAsACwALAAoACgAJAAkACQAJAAkACAAIAAgACAAHAAcABwAGAAYABgAGAAYABQAFAAUABQAFAAQABAAEAAQABAADAAMAAwADAAMAAgACAAIAAgACAAEAAQABAAEAAQAAAAAAAAAAAAAA//8AAAAAAQABAAEAAAD//wAAAAAAAAAAAAD/////AAAAAAEAAQABAAAA//8AAAAA',
  signal: 'data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2teleQtAl9/JnadfHEqZ2LmEZ0cjVJ3hwYFmSxpdpeHCdVpQHmak4ryEYVMhZ6nkvohiURVnsOW+imJPE2245b6QY0sTabnkvJdmRwtgvuK3lmlHB2G+4bKWaEgHYb7esppnRQ5ewN6ynGVDB2C/3K2aY0QMXsDbspxiRAhfv9q0m2JHCF/A2rWaYEgGYL/btJlgRgZfv9uymV9GB2C/3LGZXkcJYMDcsZhfRgdgwNyxl19GCF+/3LGYXkYIYL/cspdcRQhgwNyvl11FCGDA262XXEQJYcLbqpVaQwpiwt2ql1lCCmHC3amWV0ILYsLdqZVYQQtiwd2olFdBCmHC3aeUVkEKYsHepZRVPwtiwt+klFU/C2HB3qOTVD4MYsLfo5NTPQxhwt+hkFM8DGPC36CQUjwNY8PgoI9ROg5jw+CfjlE6DmPD4J6OUDkOZMThn41QOQ9kxOGejE44D2TE4p2LTjgQZMTinItNNxBkxOKbi003EWXF45uKTDYRZcXjmoZMNRJlxeOZhko1EmXF45mFSDMTZsbjmIVIMhNnxuOYhEcyE2fH5JeCRzEUZ8fkl4FGMRRox+SXgEYwFWjI5JZ/RS8VaMjklX5ELxZpyOSVfkQtFmnI5JR9Qy0XacjklHxCLBdqyOWTfEIsGGnJ5ZN7QSsYasnlknpAKxlqyeWSekAqGWrJ5ZF5PyoaasrlkHg+KhpqyuWQdz4pG2rK5ZB3PCkba8vlj3Y8KBxrze+ReDsqHGvN8JF3OygeaM3xj3U5KB9tzfGPdDgpH27P8o5zNyoga8/yj3I2KSFuz/KOczYpIm7R846CMSkrcdPziXYvLzJz1PSJdi0xNHXY9YhyKjQ3d9z3h24mODl74fiGayI8PHvf+oNlHD1Bftv6g2QaQEd/1veAYRxARH3Q84BdIUJIesvxflwjREd6zfB8WydFSXrP8HtbKUdKedHweVcrSEp50/F4VStJS3nT8XdSLEpKd9Tyd1IuS0x31PF2US5MTHbV8nVRL05Ndtbzc08wT0921vNyTjFQUHbX9HBOMlFQd9nzcUwyUlB22PRvTTRUUnbY9G9MNFRSdtr1bUo0VFJ22vVrSTVVU3bb9WtINlVTeN32akY1VlV43fZqRjZWVXfe92pFN1dWeN/3Z0M3WFd54PhkQThZWHng+GRBOVpZeuH4Y0E5W1p74vhiQDlaW3vi+GJAO1xbe+P5YD88XF184vhePzxdXXzj+V4+PV1efOP4XT8+Xl994/hcPj5eX37k+Fs9Pl9gfuT4Wj0/YGF/5flZPD5gYX/l+Vg8QGFhgOX5VztAYWKA5vlWO0BiY4Hm+VU6QWNjgef5VDpBY2OB5/pTOUJkZIHn+lI5QmRkgej6UTlDZWWC6PpQOENlZoLo+k84RGZnguj6TjdEZmeC6fpNOEVnaIPp+k04RWhog+n6TDZGaGmE6fpLNUZoaYTq+ko1R2lphOr6STVIammE6vpJNEhqaoXq+kg0SWpqhev6RzRKa2uF6/pGNEpra4br+kU0S2xshuz6RDRMY2l27PpDM0xja3bs+kMzTWNtduz6QjNNY2127PpCM01jbnbs+kEzTmRud+36QDNOZG537fk/M09lbnfu+T8zT2Vvd+75PjNQZW937vk+M1Bkb3jv+T0yUGRweO/5PDJRZnB48Pk8MlFmcHnw+TsyUWZxefH4OjJSZ3F58fk5MVJncXrx+TgxU2hyen/z+DcxU2hzevP4NjFUaHN78/g2MVRodHvz+DUxVWhze/T3NDBVaHR89Pg0MFZpdHz0+DMwVml1fPT4MjBWaXV89fc0MFhndnv19zQvWGh2fPX2My5YaHZ99vYyLllpd3729jEuWml3fvf2MC5aanZ+9/UvL1tqd3749C8vW2p3fvj0Li9ca3d++fQtLl1sdn/69CwuXWx2f/n0Ky1dbXd/+vQrLV5td3/69SstXW14f/r0Kixebnh/+/QpLF5ueID79CksX294gPvzKCtfb3mA+/MnK2BveYD88ycrYHB5gfvyJitgcHmB/PIlKmFxeYH98iUpYXF5gf3yJSlicXqC/fEkKWJyeoL+8SQpYnJ7gv7wIyhic3uD/vAjJ2Jze4P+7yInY3R7hP7uICdkdXuE/u0fJmR1e4T/7R8mZXZ8hf/sHiVld3yF/+sdJWV3fIb/6x0kZnd9hv/qHCRmeH2H/+kcI2Z4fYf/6BsiZ3l9iP/oGyJnenyI/+cbImh6fYj/5hoh',
  session: 'data:audio/wav;base64,UklGRmQFAABXQVZFZm10IBAAAAABAAEARKwAAIhYAQACABAAAABkYXRhQAUAAP//AQACAAEAAAD//wEAAgABAAAAAAD//wEAAgABAAAAAAD//wEAAgABAAAAAAD//wEAAgABAAAAAAD//wEAAgABAAAAAAD//wEAAgABAAAAAAD//wEAAgABAAAAAAD//wEAAQABAAAAAAD//wEAAQABAAAAAAD//wEAAQABAAAAAAD//wEAAQABAAAAAAD//wAAAQABAAAAAAD//wAAAQABAAAAAAD//wAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA//8AAAAAAAAAAAAAAAAAAAAAAAAAAAAA//8AAAAAAAAAAAAAAAAAAAAAAAAAAAAA//8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD//wAAAAAAAAAAAAAAAAAAAAAAAAAAAAD//wAAAAAAAAAAAAAAAAAAAAAAAAAAAAD//wAAAAAAAAAAAAAAAAAAAAAAAAAAAAD//wAAAAAAAAAAAAAAAAAAAAAAAAAAAAD//wAAAAAAAAAAAAAAAAAAAAAAAAAAAAD//wAAAAAAAAAAAAAAAAAAAAAAAAAAAAD//wAAAAAAAAAAAAAAAAAAAAAA',
  alert: 'data:audio/wav;base64,UklGRl9vAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhO28AAP7/AgAKAAoABAABAAUACgANAAkABAAEAAkADgANAAcAAwAGAAwADwAKAAQABAAJAA0ADQAHAAMABgALAA4ACgAEAAQACQANAAsABgADAAYACgAMAAgABAAEAAgACwAKAAUAAwAFAAkACgAHAAQABAAHAAkACAAFAAMABQAIAAkABgAEAAQABgAIAAcABQADAAQABwAHAAYABAADAAUABgAGAAQAAwAEAAUABQAEAAMAAwAEAAQABAADAAIAAwAEAAQAAwACAAIAAwADAAMAAgACAAIAAwACAAIAAQACAAIAAgABAAEAAQACAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD//wAAAAAAAAAAAAD//wAA//8AAAAAAAAAAAAA//8AAAAAAAAAAP//AAAAAP//AAAAAAAAAAD//wAAAAD//wAAAAAAAAAA//8AAAAA//8AAAAA//8AAP//AAAAAP//AAAAAP//AAD//wAAAAD//wAAAAD//wAA//8AAAAA//8AAAAA//8AAP//AAAAAAAA',
  success: 'data:audio/wav;base64,UklGRqQDAABXQVZFZm10IBAAAAABAAEARKwAAIhYAQACABAAAABkYXRhgAMAAP//AAABAAIAAQAAAP//AAABAAIAAQAAAP//AAABAAIAAQAAAP//AAABAAIAAQAAAP//AAABAAIAAQAAAP//AAABAAIAAQAAAP//AAABAAIAAQAAAP//AAABAAIAAQAAAP//AAABAAIAAQAAAP//AAABAAIAAQAAAP//AAABAAIAAQAAAP//AAABAAIAAQAAAP//AAABAAIAAQAAAP//AAABAAIAAQAAAP//AAABAAIAAQAAAP//AAABAAIAAQAAAP//AAABAAIAAQAAAP//AAABAAIAAQAAAP//AAABAAIAAQAAAP//AAABAAIAAQAAAP//AAABAAIAAQAAAP//AAABAAIAAQAAAP//AAABAAIAAQAAAP//AAABAAIAAQAAAP//AAABAAIAAQAAAP//AAABAAIAAQAAAP//AAABAAIAAQAAAP//AAABAAIAAQAAAP//AAABAAIAAQAAAP//AAABAAIAAQAAAP//AAABAAIAAQAAAP//AAABAAIAAQAAAP//AAABAAIAAQAAAP//AAABAAIAAQAAAP//AAABAAIAAQAAAP//AAABAAIAAQAAAP//AAABAAIAAQAAAP//AAABAAIAAQAAAP//AAABAAIAAQAAAP//AAABAAIAAQAAAP//AAABAAIAAQAAAP//AAABAAIAAQAAAP//AAABAAIAAQAAAP//AAABAAIAAQAAAP//AAABAAIAAQAAAP//AAABAAIAAQAAAP//AAABAAIAAQAAAP//AAABAAIAAQAAAP//AAABAAIAAQAAAP//AAABAAIAAQAAAP//AAABAAIAAQAAAP//AAABAAIAAQAAAP//AAABAAIAAQAAAP//AAABAAIAAQAAAA=='
};

const SOUND_VOLUMES: Record<NotificationSoundType, number> = {
  achievement: 0.6,
  signal: 0.5,
  session: 0.4,
  alert: 0.7,
  success: 0.5
};

export const useNotificationSounds = () => {
  const audioRefs = useRef<Map<NotificationSoundType, HTMLAudioElement>>(new Map());
  const soundEnabled = useRef<boolean>(true);

  useEffect(() => {
    // Load sound preference
    const stored = localStorage.getItem('notification_sounds_enabled');
    soundEnabled.current = stored !== 'false';

    // Pre-initialize audio elements for faster playback
    Object.entries(SOUND_URLS).forEach(([type, url]) => {
      const audio = new Audio(url);
      audio.volume = SOUND_VOLUMES[type as NotificationSoundType];
      audio.preload = 'auto';
      audioRefs.current.set(type as NotificationSoundType, audio);
    });

    return () => {
      audioRefs.current.forEach(audio => {
        audio.pause();
        audio.src = '';
      });
      audioRefs.current.clear();
    };
  }, []);

  const playSound = useCallback((type: NotificationSoundType) => {
    if (!soundEnabled.current) return;

    const audio = audioRefs.current.get(type);
    if (audio) {
      audio.currentTime = 0;
      audio.play().catch(err => {
        console.log('Audio playback failed:', err.message);
      });
    }
  }, []);

  const toggleSounds = useCallback((enabled: boolean) => {
    soundEnabled.current = enabled;
    localStorage.setItem('notification_sounds_enabled', String(enabled));
  }, []);

  const isSoundEnabled = useCallback(() => {
    return soundEnabled.current;
  }, []);

  return {
    playSound,
    toggleSounds,
    isSoundEnabled,
    playAchievementSound: () => playSound('achievement'),
    playSignalSound: () => playSound('signal'),
    playSessionSound: () => playSound('session'),
    playAlertSound: () => playSound('alert'),
    playSuccessSound: () => playSound('success')
  };
};

export default useNotificationSounds;
